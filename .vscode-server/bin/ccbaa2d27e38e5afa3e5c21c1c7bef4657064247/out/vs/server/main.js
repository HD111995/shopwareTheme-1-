const perf=require("../base/common/performance"),performance=require("perf_hooks").performance,product=require("../../../product.json");perf.mark("code/server/start"),global.vscodeServerStartTime=performance.now();function start(){if(process.argv[2]==="--exec"){process.argv.splice(1,2),require(process.argv[1]);return}const e=require("minimist")(process.argv.slice(2),{boolean:["start-server","list-extensions","print-ip-address"],string:["install-extension","install-builtin-extension","uninstall-extension","locate-extension","socket-path","host","port"]});if(!e["start-server"]&&(!!e["list-extensions"]||!!e["install-extension"]||!!e["install-builtin-extension"]||!!e["uninstall-extension"]||!!e["locate-extension"])){loadCode().then(t=>{t.spawnCli()});return}let u=null,c=null;const i=()=>(c||(c=loadCode().then(t=>t.createServer(n))),c),f=require("http"),g=require("os");let d=!0,m=!0,n=null;const o=f.createServer(async(t,r)=>(d&&(d=!1,perf.mark("code/server/firstRequest")),(await i()).handleRequest(t,r)));o.on("upgrade",async(t,r)=>(m&&(m=!1,perf.mark("code/server/firstWebSocket")),(await i()).handleUpgrade(t,r))),o.on("error",async t=>(await i()).handleServerError(t));const v=e["socket-path"]?{path:e["socket-path"]}:{host:e.host,port:parsePort(e.port)};o.listen(v,async()=>{const t=product.serverGreeting.join(`
`);let r=t?`

${t}

`:"";if(typeof v.port=="number"&&e["print-ip-address"]){const a=g.networkInterfaces();Object.keys(a).forEach(function(E){a[E].forEach(function(l){!l.internal&&l.family==="IPv4"&&(r+=`IP Address: ${l.address}
`)})})}if(n=o.address(),n===null)throw new Error("Unexpected server address");r+=`Extension host agent listening on ${typeof n=="string"?n:n.port}
`,console.log(r),perf.mark("code/server/started"),global.vscodeServerListenTime=performance.now(),await i()}),process.on("exit",()=>{o.close(),u&&u.dispose()})}function parsePort(s){try{if(s)return parseInt(s)}catch(e){console.log("Port is not a number, using 8000 instead.")}return 8e3}function loadCode(){return new Promise((s,e)=>{const p=require("path");process.env.VSCODE_INJECT_NODE_MODULE_LOOKUP_PATH=process.env.VSCODE_INJECT_NODE_MODULE_LOOKUP_PATH||p.join(__dirname,"..","..","..","remote","node_modules"),require("../../bootstrap-node").injectNodeModuleLookupPath(process.env.VSCODE_INJECT_NODE_MODULE_LOOKUP_PATH),require("../../bootstrap-amd").load("vs/server/remoteExtensionHostAgent",s,e)})}start();

//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/core/vs/server/main.js.map
